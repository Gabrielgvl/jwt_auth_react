{"version":3,"file":"index.js","sources":["../node_modules/jwt-decode/lib/atob.js","../node_modules/jwt-decode/lib/base64_url_decode.js","../node_modules/jwt-decode/lib/index.js","../src/authStore.ts","../src/index.tsx"],"sourcesContent":["/**\n * The code was extracted from:\n * https://github.com/davidchambers/Base64.js\n */\n\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\nfunction InvalidCharacterError(message) {\n  this.message = message;\n}\n\nInvalidCharacterError.prototype = new Error();\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\nfunction polyfill (input) {\n  var str = String(input).replace(/=+$/, '');\n  if (str.length % 4 == 1) {\n    throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n  }\n  for (\n    // initialize result and counters\n    var bc = 0, bs, buffer, idx = 0, output = '';\n    // get next character\n    buffer = str.charAt(idx++);\n    // character found in table? initialize bit storage and add its ascii value;\n    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n      // and if not first of each 4 characters,\n      // convert the first 8 bits to one ascii character\n      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n  ) {\n    // try to find character in table (0-63, not found => -1)\n    buffer = chars.indexOf(buffer);\n  }\n  return output;\n}\n\n\nmodule.exports = typeof window !== 'undefined' && window.atob && window.atob.bind(window) || polyfill;\n","var atob = require('./atob');\n\nfunction b64DecodeUnicode(str) {\n  return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {\n    var code = p.charCodeAt(0).toString(16).toUpperCase();\n    if (code.length < 2) {\n      code = '0' + code;\n    }\n    return '%' + code;\n  }));\n}\n\nmodule.exports = function(str) {\n  var output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  switch (output.length % 4) {\n    case 0:\n      break;\n    case 2:\n      output += \"==\";\n      break;\n    case 3:\n      output += \"=\";\n      break;\n    default:\n      throw \"Illegal base64url string!\";\n  }\n\n  try{\n    return b64DecodeUnicode(output);\n  } catch (err) {\n    return atob(output);\n  }\n};\n","'use strict';\n\nvar base64_url_decode = require('./base64_url_decode');\n\nfunction InvalidTokenError(message) {\n  this.message = message;\n}\n\nInvalidTokenError.prototype = new Error();\nInvalidTokenError.prototype.name = 'InvalidTokenError';\n\nmodule.exports = function (token,options) {\n  if (typeof token !== 'string') {\n    throw new InvalidTokenError('Invalid token specified');\n  }\n\n  options = options || {};\n  var pos = options.header === true ? 0 : 1;\n  try {\n    return JSON.parse(base64_url_decode(token.split('.')[pos]));\n  } catch (e) {\n    throw new InvalidTokenError('Invalid token specified: ' + e.message);\n  }\n};\n\nmodule.exports.InvalidTokenError = InvalidTokenError;\n","import jwtDecode from 'jwt-decode';\n\nexport const GET_USER_INFO = 'SET_USER_INFO';\nexport const LOG_IN = 'LOG_IN';\nexport const LOG_OUT = 'LOG_OUT';\nexport const GET_TOKEN = 'GET_TOKEN';\n\nexport function handleLogIn(state, { token }) {\n  const { payload: userInfo } = jwtDecode(token);\n  localStorage.setItem(state.keyPrefix, token);\n  return {\n    ...state,\n    isLoggedIn: true,\n    userInfo: { ...userInfo },\n  };\n}\n\nexport function handleLogOut(state) {\n  localStorage.removeItem(state.keyPrefix);\n  return {\n    ...state,\n    isLoggedIn: false,\n  };\n}\n","import React, {\n  createContext,\n  useCallback, useReducer,\n} from 'react';\nimport jwtDecode from 'jwt-decode';\nimport {\n  handleLogIn, handleLogOut, LOG_IN, LOG_OUT,\n} from 'authStore';\n\n// interface InitialInterface<T> {\n//   isLoggedIn: Boolean,\n//   userInfo: T | null,\n//   token: string,\n// }\n\nconst initialState = (keyPrefix = '') => ({\n  isLoggedIn: !!localStorage.getItem(keyPrefix),\n  userInfo: null,\n  keyPrefix,\n});\n\nconst jwtAuthReducer = (state, action) => {\n  switch (action.type) {\n    case LOG_IN:\n      return handleLogIn(state, action.payload);\n    case LOG_OUT:\n      return handleLogOut(state);\n    default:\n      return state;\n  }\n};\n\nconst JwtAuthContext = createContext({ keyPrefix: 'token' });\n\nexport interface JwtAuthInterface {\n  children: React.ReactNode,\n  keyPrefix: string,\n}\n\nexport const JwtAuthProvider: React.FC<JwtAuthInterface> = ({ children, keyPrefix }) => {\n  const [state, dispatch] = useReducer(jwtAuthReducer, initialState(keyPrefix));\n\n  return (\n  // @ts-ignore\n    <JwtAuthContext.Provider value={[state, dispatch]}>\n      {children}\n    </JwtAuthContext.Provider>\n  );\n};\n\nexport interface UseJwtAuthReturn<T> {\n  logIn: (token: string) => void,\n  logOut: () => void,\n  token: string | null,\n  isLoggedIn: boolean,\n  userInfo: T,\n}\n\nfunction useJWT<T = any>(keyPrefix): UseJwtAuthReturn<T> {\n  const [state, dispatch] = useReducer(jwtAuthReducer, initialState(keyPrefix));\n\n  const logIn = useCallback((token: string) => {\n    dispatch({\n      type: LOG_IN,\n      payload: {\n        token,\n      },\n    });\n  }, []);\n\n  const logOut = useCallback(() => {\n    dispatch({\n      type: LOG_OUT,\n    });\n  }, []);\n\n  const getUserInfo = useCallback(() => {\n    const token = localStorage.getItem(keyPrefix);\n    if (token) {\n      try {\n        return jwtDecode(token);\n      } catch (e) {\n        console.error(`Could not parse token: ${token}`);\n      }\n    }\n  }, []);\n\n  return {\n    logIn,\n    logOut,\n    token: localStorage.getItem(keyPrefix),\n    isLoggedIn: state.isLoggedIn,\n    userInfo: getUserInfo(),\n  };\n}\n\nexport default useJWT;\n"],"names":["jwtDecode","createContext","useReducer","React","useCallback"],"mappings":"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"}