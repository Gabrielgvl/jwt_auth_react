{"version":3,"file":"index.js","sources":["../node_modules/jwt-decode/lib/atob.js","../node_modules/jwt-decode/lib/base64_url_decode.js","../node_modules/jwt-decode/lib/index.js","../src/authStore.tsx","../src/index.tsx"],"sourcesContent":["/**\n * The code was extracted from:\n * https://github.com/davidchambers/Base64.js\n */\n\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\nfunction InvalidCharacterError(message) {\n  this.message = message;\n}\n\nInvalidCharacterError.prototype = new Error();\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\nfunction polyfill (input) {\n  var str = String(input).replace(/=+$/, '');\n  if (str.length % 4 == 1) {\n    throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n  }\n  for (\n    // initialize result and counters\n    var bc = 0, bs, buffer, idx = 0, output = '';\n    // get next character\n    buffer = str.charAt(idx++);\n    // character found in table? initialize bit storage and add its ascii value;\n    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n      // and if not first of each 4 characters,\n      // convert the first 8 bits to one ascii character\n      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n  ) {\n    // try to find character in table (0-63, not found => -1)\n    buffer = chars.indexOf(buffer);\n  }\n  return output;\n}\n\n\nmodule.exports = typeof window !== 'undefined' && window.atob && window.atob.bind(window) || polyfill;\n","var atob = require('./atob');\n\nfunction b64DecodeUnicode(str) {\n  return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {\n    var code = p.charCodeAt(0).toString(16).toUpperCase();\n    if (code.length < 2) {\n      code = '0' + code;\n    }\n    return '%' + code;\n  }));\n}\n\nmodule.exports = function(str) {\n  var output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  switch (output.length % 4) {\n    case 0:\n      break;\n    case 2:\n      output += \"==\";\n      break;\n    case 3:\n      output += \"=\";\n      break;\n    default:\n      throw \"Illegal base64url string!\";\n  }\n\n  try{\n    return b64DecodeUnicode(output);\n  } catch (err) {\n    return atob(output);\n  }\n};\n","'use strict';\n\nvar base64_url_decode = require('./base64_url_decode');\n\nfunction InvalidTokenError(message) {\n  this.message = message;\n}\n\nInvalidTokenError.prototype = new Error();\nInvalidTokenError.prototype.name = 'InvalidTokenError';\n\nmodule.exports = function (token,options) {\n  if (typeof token !== 'string') {\n    throw new InvalidTokenError('Invalid token specified');\n  }\n\n  options = options || {};\n  var pos = options.header === true ? 0 : 1;\n  try {\n    return JSON.parse(base64_url_decode(token.split('.')[pos]));\n  } catch (e) {\n    throw new InvalidTokenError('Invalid token specified: ' + e.message);\n  }\n};\n\nmodule.exports.InvalidTokenError = InvalidTokenError;\n","import jwtDecode from 'jwt-decode';\n\nexport const SET_USER_INFO = 'SET_USER_INFO';\nexport const LOG_IN = 'LOG_IN';\nexport const LOG_OUT = 'LOG_OUT';\nexport const GET_TOKEN = 'GET_TOKEN';\n\nexport function getToken(state) {\n  return localStorage.getItem(state.token);\n}\n\nexport function handleSetUserInfo(state) {\n  const token = getToken(state);\n  const { payload: userInfo } = jwtDecode(token);\n  return {\n    ...state,\n    userInfo: { ...userInfo },\n  };\n}\n\nexport function handleLogIn(state, { token }) {\n  const { payload: userInfo } = jwtDecode(token);\n  localStorage.setItem(state.token, token);\n  return {\n    ...state,\n    isLoggedIn: true,\n    isLogin: true,\n    userInfo: { ...userInfo },\n  };\n}\n\nexport function handleLogOut(state) {\n  localStorage.removeItem(state.token);\n  return {\n    ...state,\n    isLoggedIn: false,\n  };\n}\n","import React, { createContext, useContext, useReducer } from 'react';\n\nimport {\n  handleLogIn,\n  handleLogOut,\n  handleSetUserInfo,\n  LOG_IN,\n  LOG_OUT,\n  SET_USER_INFO,\n  GET_TOKEN, getToken,\n} from './authStore';\n\ninterface InitialInterface {\n  isLoggedIn: Boolean,\n  userInfo: Object | null,\n  isLogin: Boolean,\n  cache: Object,\n  token: String,\n}\n\nconst initialState = (token = '') => ({\n  isLoggedIn: !!localStorage.getItem(token),\n  userInfo: null,\n  isLogin: false,\n  cache: {},\n  token,\n});\n\nconst JwtAuthContext = createContext<InitialInterface>(initialState());\n\nconst jwtAuthReducer = (state, action) => {\n  switch (action.type) {\n    case SET_USER_INFO:\n      return handleSetUserInfo(state);\n    case LOG_IN:\n      return handleLogIn(state, action.payload);\n    case LOG_OUT:\n      return handleLogOut(state);\n    case GET_TOKEN:\n      return getToken(state);\n    default:\n      return state;\n  }\n};\n\ninterface JwtAuthInterface {\n    children: React.ReactNode,\n    keyPrefix: String,\n    jwtToken?: String,\n}\n\nexport const JwtAuthProvider: React.FC<JwtAuthInterface> = ({ children, keyPrefix, jwtToken }) => {\n  const [state, dispatch] = useReducer(jwtAuthReducer, initialState(`${keyPrefix}:${jwtToken}`));\n\n  return (\n  // @ts-ignore\n    <JwtAuthContext.Provider value={[state, dispatch]}>\n      {children}\n    </JwtAuthContext.Provider>\n  );\n};\n\nJwtAuthProvider.defaultProps = {\n  jwtToken: 'token',\n};\n\ninterface UseJwtAuthReturn {\n    setUserInfo: () => void,\n    logIn: (token) => void,\n    logOut: () => void,\n    token: String | null,\n    handleLogin: (token, effect?) => void,\n    isLoggedIn: Boolean,\n    isLogin: Boolean,\n    userInfo: {},\n}\n\nconst useJwtAuth: () => UseJwtAuthReturn = () : UseJwtAuthReturn => {\n  const [state, dispatch] = useContext<any>(JwtAuthContext);\n\n  const setUserInfo = () => {\n    dispatch({\n      type: SET_USER_INFO,\n    });\n  };\n\n  const logIn = (token) => {\n    dispatch({\n      type: LOG_IN,\n      payload: {\n        token,\n      },\n    });\n  };\n\n  const logOut = () => {\n    dispatch({\n      type: LOG_OUT,\n    });\n  };\n\n  const handleLogin = async (token, effect = () => {}) => {\n    logIn(token);\n    effect();\n  };\n\n  // const getToken = () => {\n  //   dispatch({\n  //     type: GET_TOKEN,\n  //   });\n  // };\n\n  return {\n    setUserInfo,\n    logIn,\n    logOut,\n    handleLogin,\n    token: localStorage.getItem(state.token),\n    isLoggedIn: state.isLoggedIn,\n    isLogin: state.isLogin,\n    userInfo: state.userInfo,\n  };\n};\n\nexport default useJwtAuth;\n"],"names":["chars","InvalidCharacterError","message","prototype","Error","name","polyfill","input","str","String","replace","length","bc","bs","buffer","idx","output","charAt","fromCharCode","indexOf","window","atob","bind","b64DecodeUnicode","decodeURIComponent","m","p","code","charCodeAt","toString","toUpperCase","err","InvalidTokenError","token","options","pos","header","JSON","parse","base64_url_decode","split","e","jwtDecode","createContext","useReducer","React","useContext"],"mappings":"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"}